(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[331],{172:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},960:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]])},1813:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]])},3755:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var s=a(5155),r=a(2115),i=a(6874),l=a.n(i),n=a(5695),d=a(285),c=a(6695),o=a(10),h=a(172),m=a(1813),p=a(960),x=a(9968),u=a(4301),y=a(157);let f=(0,y.A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),v=(0,y.A)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),g=(0,y.A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),j=(0,y.A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),N=(0,y.A)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),k=(0,y.A)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);var w=a(9591),A=a(8763),b=a(7223),D=a(3717),E=a(3013),S=a(5471),M=a(7481),_=a(4271),R=a(1950),C=a(9434),P=a(2643);function O(){let[e,t]=r.useState(null),[a,i]=r.useState(!1),[y,O]=r.useState([]),[G,T]=r.useState(!0),[L,q]=r.useState(!1),[H,I]=r.useState(!1),[V,z]=r.useState(null),{toast:U}=(0,M.dj)(),Z=(0,n.useRouter)();r.useEffect(()=>{T(!0);let e="true"===sessionStorage.getItem("isGuest");if(i(e),e)return void T(!1);let a=async()=>{let{data:{session:e}}=await P.N.auth.getSession();if(!(null==e?void 0:e.user)){U({title:"غير مصرح به",description:"يرجى تسجيل الدخول لعرض الرحلات المحفوظة.",variant:"destructive"}),Z.push("/"),T(!1);return}t(e.user);let{data:a,error:s}=await P.N.from("trips").select("*").eq("user_id",e.user.id).order("created_at",{ascending:!1});s?(U({variant:"destructive",title:"خطأ في تحميل الرحلات",description:s.message}),O([])):a?O(a.map(e=>({...e,details:"string"==typeof e.details?JSON.parse(e.details):e.details,transactions:(Array.isArray(e.transactions)?e.transactions:[]).map(e=>({...e,date:new Date(e.date),amount:Number(e.amount)||0})),exchangeRates:"string"==typeof e.exchange_rates?JSON.parse(e.exchange_rates):e.exchange_rates,createdAt:e.created_at?new Date(e.created_at).toISOString():new Date().toISOString(),updatedAt:e.updated_at?new Date(e.updated_at).toISOString():void 0})).map(e=>({...e,details:{...e.details,tripStartDate:new Date(e.details.tripStartDate),tripEndDate:new Date(e.details.tripEndDate)}}))):O([]),T(!1)};e||a()},[Z,U]);let F=e=>"INTERNAL"===e.details.destinationType&&e.details.cityName?e.details.cityName:"EXTERNAL"===e.details.destinationType&&e.details.countryName?e.details.countryName:"غير محدد",$=e=>{z(e),I(!0)},Y=async()=>{if(V&&e){q(!0);try{let{error:t}=await P.N.from("trips").delete().eq("id",V.id).eq("user_id",e.id);if(t)throw t;O(e=>e.filter(e=>e.id!==V.id)),U({title:"تم حذف الرحلة",description:'تم حذف رحلة "'.concat(V.name,'".')})}catch(e){U({variant:"destructive",title:"خطأ في الحذف",description:e.message||"لم يتم حذف الرحلة."})}finally{q(!1),I(!1),z(null)}}},J=e=>{Z.push("/manage-trip?edit=".concat(e))},W=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.Sj.EGP,a=0,s=0,r=0,i=0;return e.transactions&&Array.isArray(e.transactions)&&e.exchangeRates?(e.transactions.forEach(l=>{let n=(0,_.hZ)(l.amount,l.currency,t,e.exchangeRates);l.type===D.D_.REVENUE||l.type===D.D_.CUSTODY_HANDOVER_CLIENT?a+=n:l.type===D.D_.EXPENSE?s+=n:l.type===D.D_.CUSTODY_HANDOVER_OWNER?r+=n:l.type===D.D_.DRIVER_FEE&&(i+=n)}),a+r-s-i-r):0},B=(e,t)=>{let a=(0,R.So)(t),r=e.toLocaleString("ar-EG",{minimumFractionDigits:2,maximumFractionDigits:2}),i=e>=0?"text-[hsl(var(--positive-balance-fg))]":"text-[hsl(var(--negative-balance-fg))]";return(0,s.jsxs)("span",{className:(0,C.cn)(i,"font-semibold"),children:[(null==a?void 0:a.symbol)||"",r]})};return G?(0,s.jsx)("div",{className:"container mx-auto p-4 md:p-8 space-y-8",children:(0,s.jsxs)("div",{className:"text-center py-10 flex justify-center items-center",children:[(0,s.jsx)(h.A,{className:"me-3 h-6 w-6 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-lg text-muted-foreground",children:"جارٍ التحميل..."})]})}):a?(0,s.jsxs)("div",{className:"container mx-auto p-4 md:p-8 space-y-6 text-center",children:[(0,s.jsx)(m.A,{className:"mx-auto h-16 w-16 text-primary mb-4"}),(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"وضع الضيف"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"لا يمكنك عرض الرحلات المحفوظة في وضع الضيف. يرجى تسجيل الدخول أو إنشاء حساب للوصول لهذه الميزة."}),(0,s.jsx)(d.$,{onClick:()=>Z.push("/"),className:"mt-4",children:"العودة إلى صفحة تسجيل الدخول"})]}):(0,s.jsxs)("div",{className:"container mx-auto p-4 md:p-8 space-y-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold flex items-center",children:[(0,s.jsx)(p.A,{className:"me-3 h-8 w-8 text-primary"}),"الرحلات المحفوظة"]}),(0,s.jsx)(l(),{href:"/dashboard",children:(0,s.jsxs)(d.$,{variant:"outline",children:[(0,s.jsx)(x.A,{className:"ms-2 h-4 w-4"}),"العودة إلى لوحة التحكم"]})})]}),0===y.length?(0,s.jsx)(c.Zp,{className:"shadow-md",children:(0,s.jsxs)(c.Wu,{className:"p-8 text-center",children:[(0,s.jsx)("p",{className:"text-xl text-muted-foreground",children:"لا توجد رحلات محفوظة حتى الآن."}),(0,s.jsx)(l(),{href:"/manage-trip?new=true",passHref:!0,children:(0,s.jsxs)(d.$,{className:"mt-4",children:[(0,s.jsx)(u.A,{className:"ms-2 h-5 w-5"}),"ابدأ بتسجيل رحلة جديدة"]})})]})}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(e=>{var t;let a=W(e,D.Sj.EGP);return(0,s.jsxs)(c.Zp,{className:"shadow-lg hover:shadow-xl transition-shadow flex flex-col",children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsx)(c.ZB,{className:"text-primary text-lg truncate",children:e.name}),(0,s.jsxs)(c.BT,{children:["حُفظت في: ",(0,E.GP)(new Date(e.createdAt),"PPpp",{locale:S.G}),e.updatedAt&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),"آخر تحديث: ",(0,E.GP)(new Date(e.updatedAt),"PPpp",{locale:S.G})]})]})]}),(0,s.jsxs)(c.Wu,{className:"space-y-3 text-sm flex-grow",children:[(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(g,{className:"ms-2 h-4 w-4 text-primary/80"}),(0,s.jsxs)("span",{children:["السائق: ",e.details.driverName]})]}),(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(j,{className:"ms-2 h-4 w-4 text-primary/80"}),(0,s.jsxs)("span",{children:["الوجهة: ",F(e)]})]}),(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(N,{className:"ms-2 h-4 w-4 text-primary/80"}),(0,s.jsxs)("span",{children:["من: ",(0,E.GP)(new Date(e.details.tripStartDate),"P",{locale:S.G})," إلى: ",(0,E.GP)(new Date(e.details.tripEndDate),"P",{locale:S.G})]})]}),(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(k,{className:"ms-2 h-4 w-4 text-primary/80"}),(0,s.jsxs)("span",{children:["عدد المعاملات: ",(null==(t=e.transactions)?void 0:t.length)||0]})]})]}),(0,s.jsxs)(c.wL,{className:"pt-3 mt-auto border-t flex-col items-start space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center w-full justify-between",children:[(0,s.jsxs)("span",{className:"font-semibold text-sm flex items-center",children:[(0,s.jsx)(w.A,{className:"ms-1 h-4 w-4 text-primary/90"}),"صافي الربح/الخسارة:"]}),(0,s.jsxs)("span",{className:(0,C.cn)("font-bold text-md flex items-center",a>=0?"text-[hsl(var(--positive-balance-fg))]":"text-[hsl(var(--negative-balance-fg))]"),children:[(0,s.jsx)(a>=0?f:v,{className:"ms-1 h-4 w-4"}),B(a,D.Sj.EGP)]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-3 w-full",children:[(0,s.jsxs)(d.$,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>J(e.id),children:[(0,s.jsx)(A.A,{className:"ms-1 h-3.5 w-3.5"}),"تعديل"]}),(0,s.jsxs)(d.$,{variant:"destructive",size:"sm",className:"flex-1",onClick:()=>$(e),disabled:L&&(null==V?void 0:V.id)===e.id,children:[L&&(null==V?void 0:V.id)===e.id?(0,s.jsx)(h.A,{className:"ms-1 h-3.5 w-3.5 animate-spin"}):(0,s.jsx)(b.A,{className:"ms-1 h-3.5 w-3.5"}),"مسح الرحلة"]})]})]})]},e.id)})}),(0,s.jsx)(o.Lt,{open:H,onOpenChange:I,children:(0,s.jsxs)(o.EO,{children:[(0,s.jsxs)(o.wd,{children:[(0,s.jsx)(o.r7,{children:"هل أنت متأكد من رغبتك في حذف هذه الرحلة؟"}),(0,s.jsxs)(o.$v,{children:["لا يمكن التراجع عن هذا الإجراء. سيتم حذف بيانات الرحلة بشكل دائم.",(0,s.jsx)("br",{}),"الرحلة: ",(0,s.jsx)("strong",{children:null==V?void 0:V.name})]})]}),(0,s.jsxs)(o.ck,{children:[(0,s.jsx)(o.Zr,{onClick:()=>z(null),disabled:L,children:"إلغاء"}),(0,s.jsx)(o.Rx,{onClick:Y,disabled:L,children:L?(0,s.jsx)(h.A,{className:"ms-2 h-4 w-4 animate-spin"}):"تأكيد الحذف"})]})]})})]})}},4301:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},7223:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},7649:(e,t,a)=>{"use strict";a.d(t,{UC:()=>O,VY:()=>q,ZD:()=>T,ZL:()=>C,bL:()=>_,hE:()=>L,hJ:()=>P,l9:()=>R,rc:()=>G});var s=a(2115),r=a(6081),i=a(6101),l=a(5452),n=a(5185),d=a(9708),c=a(5155),o="AlertDialog",[h,m]=(0,r.A)(o,[l.Hs]),p=(0,l.Hs)(),x=e=>{let{__scopeAlertDialog:t,...a}=e,s=p(t);return(0,c.jsx)(l.bL,{...s,...a,modal:!0})};x.displayName=o;var u=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...s}=e,r=p(a);return(0,c.jsx)(l.l9,{...r,...s,ref:t})});u.displayName="AlertDialogTrigger";var y=e=>{let{__scopeAlertDialog:t,...a}=e,s=p(t);return(0,c.jsx)(l.ZL,{...s,...a})};y.displayName="AlertDialogPortal";var f=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...s}=e,r=p(a);return(0,c.jsx)(l.hJ,{...r,...s,ref:t})});f.displayName="AlertDialogOverlay";var v="AlertDialogContent",[g,j]=h(v),N=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,children:r,...o}=e,h=p(a),m=s.useRef(null),x=(0,i.s)(t,m),u=s.useRef(null);return(0,c.jsx)(l.G$,{contentName:v,titleName:k,docsSlug:"alert-dialog",children:(0,c.jsx)(g,{scope:a,cancelRef:u,children:(0,c.jsxs)(l.UC,{role:"alertdialog",...h,...o,ref:x,onOpenAutoFocus:(0,n.m)(o.onOpenAutoFocus,e=>{var t;e.preventDefault(),null==(t=u.current)||t.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,c.jsx)(d.xV,{children:r}),(0,c.jsx)(M,{contentRef:m})]})})})});N.displayName=v;var k="AlertDialogTitle",w=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...s}=e,r=p(a);return(0,c.jsx)(l.hE,{...r,...s,ref:t})});w.displayName=k;var A="AlertDialogDescription",b=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...s}=e,r=p(a);return(0,c.jsx)(l.VY,{...r,...s,ref:t})});b.displayName=A;var D=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...s}=e,r=p(a);return(0,c.jsx)(l.bm,{...r,...s,ref:t})});D.displayName="AlertDialogAction";var E="AlertDialogCancel",S=s.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...s}=e,{cancelRef:r}=j(E,a),n=p(a),d=(0,i.s)(t,r);return(0,c.jsx)(l.bm,{...n,...s,ref:d})});S.displayName=E;var M=e=>{let{contentRef:t}=e,a="`".concat(v,"` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the `").concat(v,"` by passing a `").concat(A,"` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an `id` and passing the same value to the `aria-describedby` prop in `").concat(v,"`. If the description is confusing or duplicative for sighted users, you can use the `@radix-ui/react-visually-hidden` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog");return s.useEffect(()=>{var e;document.getElementById(null==(e=t.current)?void 0:e.getAttribute("aria-describedby"))||console.warn(a)},[a,t]),null},_=x,R=u,C=y,P=f,O=N,G=D,T=S,L=w,q=b},8763:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},9494:(e,t,a)=>{Promise.resolve().then(a.bind(a,3755))},9591:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]])},9968:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[856,648,239,370,656,441,684,358],()=>t(9494)),_N_E=e.O()}]);