(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[164],{2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var s=a(5155),r=a(2115),n=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...l})});l.displayName="Input"},2697:(e,t,a)=>{Promise.resolve().then(a.bind(a,6788))},4165:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>x,Es:()=>h,HM:()=>m,L3:()=>f,c7:()=>p,lG:()=>o,rr:()=>j,zM:()=>d});var s=a(5155),r=a(2115),n=a(5452),l=a(5318),i=a(9434);let o=n.bL,d=n.l9,c=n.ZL,m=n.bm,u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});u.displayName=n.hJ.displayName;let x=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(n.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[r,(0,s.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=n.UC.displayName;let p=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="DialogFooter";let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});f.displayName=n.hE.displayName;let j=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})});j.displayName=n.VY.displayName},5057:(e,t,a)=>{"use strict";a.d(t,{J:()=>d});var s=a(5155),r=a(2115),n=a(968),l=a(2085),i=a(9434);let o=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.b,{ref:t,className:(0,i.cn)(o(),a),...r})});d.displayName=n.b.displayName},6788:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>e6});var s=a(5155),r=a(2115),n=a(5028),l=a(5695),i=a(3013),o=a(221),d=a(2177),c=a(285),m=a(7759),u=a(2523),x=a(9409),p=a(5471),h=a(1920),f=a(9434),j=a(965),g=a(3158),y=a(3900);function v(e){let{className:t,classNames:a,showOutsideDays:r=!0,...n}=e;return(0,s.jsx)(y.hv,{showOutsideDays:r,className:(0,f.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,f.cn)((0,c.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,f.cn)((0,c.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(j.A,{className:(0,f.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(g.A,{className:(0,f.cn)("h-4 w-4",t),...a})}},...n})}v.displayName="Calendar";var N=a(547);let b=N.bL,w=N.l9,S=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:n=4,...l}=e;return(0,s.jsx)(N.ZL,{children:(0,s.jsx)(N.UC,{ref:t,align:r,sideOffset:n,className:(0,f.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});function D(e){let{date:t,setDate:a,disabled:r}=e;return(0,s.jsxs)(b,{children:[(0,s.jsx)(w,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",className:(0,f.cn)("w-full justify-start text-start font-normal",!t&&"text-muted-foreground"),children:[(0,s.jsx)(h.A,{className:"ms-2 h-4 w-4"}),t?(0,i.GP)(t,"PPP",{locale:p.G}):(0,s.jsx)("span",{children:"اختر تاريخًا"})]})}),(0,s.jsx)(S,{className:"w-auto p-0",dir:"rtl",children:(0,s.jsx)(v,{locale:p.G,mode:"single",selected:t,onSelect:a,disabled:r,initialFocus:!0,dir:"rtl"})})]})}S.displayName=N.UC.displayName;var E=a(7481),C=a(1153),R=a(1950),A=a(3717);let T=C.z.object({type:C.z.nativeEnum(A.D_,{errorMap:()=>({message:"يرجى اختيار نوع المعاملة."})}),description:C.z.string().min(1,"الوصف مطلوب.").max(100,"الوصف طويل جدًا."),amount:C.z.coerce.number({invalid_type_error:"يجب أن يكون المبلغ رقمًا."}).positive("يجب أن يكون المبلغ رقمًا موجبًا."),currency:C.z.nativeEnum(R.Sj,{errorMap:()=>({message:"يرجى اختيار عملة."})}),date:C.z.date({required_error:"التاريخ مطلوب."})}),I=C.z.object({driverName:C.z.string().min(1,"اسم السائق مطلوب."),tripStartDate:C.z.date({required_error:"تاريخ بدء الرحلة مطلوب."}),tripEndDate:C.z.date({required_error:"تاريخ نهاية الرحلة مطلوب."}),destinationType:C.z.nativeEnum(A.bE,{errorMap:()=>({message:"يرجى اختيار نوع الوجهة."})}),cityName:C.z.string().optional(),countryName:C.z.string().optional()}).refine(e=>!e.tripEndDate||!e.tripStartDate||e.tripEndDate>=e.tripStartDate,{message:"تاريخ نهاية الرحلة يجب أن يكون بعد أو نفس تاريخ البدء.",path:["tripEndDate"]}).superRefine((e,t)=>{e.destinationType!==A.bE.EXTERNAL||e.countryName&&0!==e.countryName.trim().length||t.addIssue({code:C.z.ZodIssueCode.custom,message:"اسم البلد مطلوب للوجهات الخارجية.",path:["countryName"]}),e.destinationType!==A.bE.INTERNAL||e.cityName&&0!==e.cityName.trim().length||t.addIssue({code:C.z.ZodIssueCode.custom,message:"اسم المدينة مطلوب للوجهات الداخلية.",path:["cityName"]})});async function O(e){let t=T.safeParse(e);return t.success?{success:!0,data:{id:crypto.randomUUID(),type:t.data.type,date:t.data.date,description:t.data.description,amount:t.data.amount,currency:t.data.currency}}:{success:!1,error:"Invalid data provided.",errors:t.error.issues}}async function _(e,t){let a=T.safeParse(t);return a.success?{success:!0,data:{id:e,type:a.data.type,date:a.data.date,description:a.data.description,amount:a.data.amount,currency:a.data.currency}}:{success:!1,error:"البيانات المقدمة غير صالحة.",errors:a.error.issues}}var z=a(172),k=a(6695);let P=()=>({type:A.D_.EXPENSE,description:"",amount:void 0,currency:R.HE[0].code,date:void 0}),F=r.memo(function(e){let{onTransactionAdded:t,transactionToEdit:a,onTransactionUpdated:n,onCancelEdit:l,className:i,destinationType:p}=e,{toast:h}=(0,E.dj)(),[f,j]=r.useState(!1),g=!!a,y=(0,d.mN)({resolver:(0,o.u)(T),mode:"onChange",reValidateMode:"onChange",defaultValues:a?{...a,amount:a.amount,date:new Date(a.date)}:P()}),v=r.useMemo(()=>p===A.bE.INTERNAL?R.HE.filter(e=>e.code===A.Sj.EGP):R.HE,[p]);r.useEffect(()=>{p===A.bE.INTERNAL?y.setValue("currency",A.Sj.EGP):g||y.setValue("currency",R.HE[0].code)},[p,g,y.setValue]),r.useEffect(()=>{a?y.reset({...a,amount:a.amount,date:new Date(a.date)}):0===y.formState.submitCount||null===a&&"function"==typeof l?y.reset({...P(),date:new Date}):void 0===y.getValues("date")&&y.formState.submitCount>0&&!g||void 0===y.getValues("date")&&y.setValue("date",new Date,{shouldValidate:!1,shouldDirty:!1})},[a,y.reset,y.setValue,l,y.formState.submitCount,y.getValues]);let N=y.watch("type"),b=r.useMemo(()=>{var e;return(null==(e=(0,R.lW)(N))?void 0:e.descriptionPlaceholder)||"الوصف"},[N]);async function w(e){p===A.bE.INTERNAL&&(e.currency=A.Sj.EGP),j(!0);try{let s;(s=g&&a?await _(a.id,e):await O(e)).success&&s.data?(h({title:g?"تم تعديل المعاملة":"تمت إضافة المعاملة",description:"تم ".concat(g?"تحديث":"تسجيل",' "').concat(s.data.description,'" بنجاح.')}),g&&n?n(s.data):!g&&t&&(t(s.data),y.reset({...P(),date:new Date}))):(h({variant:"destructive",title:g?"خطأ في تعديل المعاملة":"خطأ في إضافة المعاملة",description:s.error||"حدث خطأ غير معروف."}),s.errors&&s.errors.forEach(e=>{y.setError(e.path[0],{type:"manual",message:e.message})}))}catch(e){h({variant:"destructive",title:"خطأ في الإرسال",description:"لم يتمكن من إرسال النموذج. يرجى المحاولة مرة أخرى."})}finally{j(!1)}}let S=g?"تعديل المعاملة":"إضافة معاملة جديدة",C=g?"قم بتحديث تفاصيل معاملتك.":"أدخل تفاصيل معاملتك المالية.",I=g?"حفظ التعديلات":"إضافة معاملة",F=(0,s.jsx)(m.lV,{...y,children:(0,s.jsxs)("form",{onSubmit:y.handleSubmit(w),onKeyDown:e=>{"Enter"===e.key&&e.stopPropagation()},className:"space-y-6",children:[(0,s.jsx)(m.zB,{control:y.control,name:"type",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"نوع المعاملة"}),(0,s.jsxs)(x.l6,{onValueChange:t.onChange,value:t.value,dir:"rtl",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"اختر نوع المعاملة"})})}),(0,s.jsx)(x.gC,{children:R.Kf.map(e=>(0,s.jsx)(x.eb,{value:e.type,children:e.name},e.type))})]}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:y.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"الوصف"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(u.p,{placeholder:b,...t})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(m.zB,{control:y.control,name:"amount",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"المبلغ"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(u.p,{type:"number",placeholder:"0.00",...t,step:"0.01",value:void 0===t.value||null===t.value||Number.isNaN(t.value)?"":String(t.value),onChange:e=>{let a=e.target.value;t.onChange(""===a?void 0:parseFloat(a))}})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:y.control,name:"currency",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"العملة"}),p===A.bE.INTERNAL?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{type:"hidden",value:A.Sj.EGP,name:t.name}),(0,s.jsx)(u.p,{value:"الجنيه المصري (ج.م)",disabled:!0,readOnly:!0})]}):(0,s.jsxs)(x.l6,{onValueChange:t.onChange,value:t.value,dir:"rtl",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"اختر العملة"})})}),(0,s.jsx)(x.gC,{children:v.map(e=>(0,s.jsxs)(x.eb,{value:e.code,children:[e.name," (",e.symbol,")"]},e.code))})]}),(0,s.jsx)(m.C5,{})]})}})]}),(0,s.jsx)(m.zB,{control:y.control,name:"date",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{className:"flex flex-col",children:[(0,s.jsx)(m.lR,{children:"التاريخ"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(D,{date:t.value,setDate:t.onChange})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsxs)("div",{className:"flex gap-2",children:[g&&l&&(0,s.jsx)(c.$,{type:"button",variant:"outline",onClick:l,className:"flex-1",children:"إلغاء"}),(0,s.jsxs)(c.$,{type:"submit",className:"flex-1",disabled:f,children:[f&&(0,s.jsx)(z.A,{className:"ms-2 h-4 w-4 animate-spin"}),I]})]})]})});return g?(0,s.jsx)("div",{className:i,children:F}):(0,s.jsxs)(k.Zp,{className:"shadow-lg ".concat(i),children:[(0,s.jsxs)(k.aR,{children:[(0,s.jsx)(k.ZB,{children:S}),(0,s.jsx)(k.BT,{children:C})]}),(0,s.jsx)(k.Wu,{children:F})]})}),M=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,f.cn)("w-full caption-bottom text-sm",a),...r})})});M.displayName="Table";let G=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("thead",{ref:t,className:(0,f.cn)("[&_tr]:border-b",a),...r})});G.displayName="TableHeader";let L=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,f.cn)("[&_tr:last-child]:border-0",a),...r})});L.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,f.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r})}).displayName="TableFooter";let V=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tr",{ref:t,className:(0,f.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r})});V.displayName="TableRow";let U=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("th",{ref:t,className:(0,f.cn)("h-12 px-4 text-start align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pe-0",a),...r})});U.displayName="TableHead";let J=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("td",{ref:t,className:(0,f.cn)("p-4 align-middle [&:has([role=checkbox])]:pe-0",a),...r})});J.displayName="TableCell",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("caption",{ref:t,className:(0,f.cn)("mt-4 text-sm text-muted-foreground",a),...r})}).displayName="TableCaption";var B=a(7204),$=a(3343),Z=a(9572),H=a(9556),Y=a(7150),q=a(5943),W=a(7223),X=a(6317),K=a(518),Q=a(154);let ee=X.bL,et=X.l9;X.YJ,X.ZL,X.Pb,X.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:n,...l}=e;return(0,s.jsxs)(X.ZP,{ref:t,className:(0,f.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...l,children:[n,(0,s.jsx)(j.A,{className:"mr-auto"})," "]})}).displayName=X.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(X.G5,{ref:t,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=X.G5.displayName;let ea=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(X.ZL,{children:(0,s.jsx)(X.UC,{ref:t,sideOffset:r,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});ea.displayName=X.UC.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(X.q7,{ref:t,className:(0,f.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n})}).displayName=X.q7.displayName;let es=r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...l}=e;return(0,s.jsxs)(X.H_,{ref:t,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...l,children:[(0,s.jsxs)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:[" ",(0,s.jsx)(X.VF,{children:(0,s.jsx)(K.A,{className:"h-4 w-4"})})]}),r]})});es.displayName=X.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(X.hN,{ref:t,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsxs)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:[" ",(0,s.jsx)(X.VF,{children:(0,s.jsx)(Q.A,{className:"h-2 w-2 fill-current"})})]}),r]})}).displayName=X.hN.displayName;let er=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(X.JU,{ref:t,className:(0,f.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pr-8",a),...n})});er.displayName=X.JU.displayName;let en=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(X.wv,{ref:t,className:(0,f.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});en.displayName=X.wv.displayName;var el=a(4165);let ei=r.memo(function(e){let{transactions:t,onDeleteTransaction:a,onEditTransactionRequest:n}=e,[l,o]=r.useState("date"),[x,h]=r.useState("desc"),[f,j]=r.useState(!1),[g,y]=r.useState(void 0),[v,N]=r.useState(void 0),[b,w]=r.useState(new Set),[S,E]=r.useState(""),[C,A]=r.useState(void 0),[T,I]=r.useState(void 0),[O,_]=r.useState(new Set),z=(0,d.mN)(),P=e=>{l===e?h("asc"===x?"desc":"asc"):(o(e),h("asc"))},F=e=>{_(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},X=e=>{w(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},K=r.useMemo(()=>{let e=[...t].map(e=>({...e,date:"string"==typeof e.date?(0,$.H)(e.date):e.date}));if(g){let t=new Date(g);t.setHours(0,0,0,0),e=e.filter(e=>e.date>=t)}if(v){let t=new Date(v);t.setHours(23,59,59,999),e=e.filter(e=>e.date<=t)}return(b.size>0&&(e=e.filter(e=>b.has(e.type))),""!==S.trim()&&(e=e.filter(e=>e.description.toLowerCase().includes(S.toLowerCase()))),void 0!==C&&(e=e.filter(e=>e.amount>=C)),void 0!==T&&(e=e.filter(e=>e.amount<=T)),O.size>0&&(e=e.filter(e=>O.has(e.currency))),"none"===l)?e:e.sort((e,t)=>{let a=e[l],s=t[l];return(a instanceof Date&&s instanceof Date&&(a=a.getTime(),s=s.getTime()),"type"===l&&(a=e.type.toString(),s=t.type.toString()),"string"==typeof a&&"string"==typeof s)?"asc"===x?a.localeCompare(s,"ar"):s.localeCompare(a,"ar"):"number"==typeof a&&"number"==typeof s?"asc"===x?a-s:s-a:0})},[t,l,x,g,v,b,S,C,T,O]),Q=(e,t)=>{let a=(0,R.So)(t);return"".concat((null==a?void 0:a.symbol)||"").concat(e.toLocaleString("ar",{minimumFractionDigits:2,maximumFractionDigits:2}))},ei=e=>{var t;return(null==(t=(0,R.lW)(e))?void 0:t.name)||e};return 0===t.length?(0,s.jsxs)(k.Zp,{className:"shadow-lg",children:[(0,s.jsx)(k.aR,{children:(0,s.jsx)(k.ZB,{children:"المعاملات"})}),(0,s.jsx)(k.Wu,{children:(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد معاملات بعد. أضف واحدة للبدء!"})})]}):(0,s.jsxs)(k.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(k.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(k.ZB,{children:"سجل المعاملات"}),(0,s.jsx)(k.BT,{children:"عرض وإدارة معاملاتك المسجلة."})]}),(0,s.jsxs)(el.lG,{open:f,onOpenChange:j,children:[(0,s.jsx)(el.zM,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",size:"sm",children:[(0,s.jsx)(Z.A,{className:"ms-2 h-4 w-4"}),"تصفية / فرز"]})}),(0,s.jsxs)(el.Cf,{className:"sm:max-w-md md:max-w-lg lg:max-w-xl",children:[(0,s.jsxs)(el.c7,{children:[(0,s.jsx)(el.L3,{children:"تصفية المعاملات"}),(0,s.jsx)(el.rr,{children:"قم بتطبيق الفلاتر لعرض معاملات محددة."})]}),(0,s.jsx)(m.lV,{...z,children:(0,s.jsxs)("div",{className:"grid gap-4 py-4 max-h-[60vh] overflow-y-auto px-2",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)(m.zB,{control:z.control,name:"dateFilterFrom",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"من تاريخ"}),(0,s.jsx)(D,{date:g,setDate:y})]})}),(0,s.jsx)(m.zB,{control:z.control,name:"dateFilterTo",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"إلى تاريخ"}),(0,s.jsx)(D,{date:v,setDate:N})]})})]}),(0,s.jsx)(m.zB,{control:z.control,name:"typeFilter",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"نوع المعاملة"}),(0,s.jsxs)(ee,{children:[(0,s.jsx)(et,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",className:"w-full justify-between text-start",children:[(0,s.jsx)("span",{children:0===b.size?"جميع الأنواع":"".concat(b.size," أنواع مختارة")}),(0,s.jsx)(H.A,{className:"h-4 w-4 opacity-50"})]})}),(0,s.jsxs)(ea,{align:"start",className:"w-[var(--radix-dropdown-menu-trigger-width)] max-h-60 overflow-y-auto",children:[(0,s.jsx)(er,{children:"اختر الأنواع"}),(0,s.jsx)(en,{}),R.Kf.map(e=>(0,s.jsx)(es,{checked:b.has(e.type),onCheckedChange:()=>X(e.type),children:e.name},e.type))]})]})]})}),(0,s.jsx)(m.zB,{control:z.control,name:"descriptionFilter",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"الوصف"}),(0,s.jsx)(u.p,{placeholder:"بحث بالوصف...",value:S,onChange:e=>E(e.target.value)})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)(m.zB,{control:z.control,name:"amountMinFilter",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"أقل مبلغ"}),(0,s.jsx)(u.p,{type:"number",placeholder:"0.00",value:void 0===C?"":String(C),onChange:e=>A(""===e.target.value?void 0:parseFloat(e.target.value))})]})}),(0,s.jsx)(m.zB,{control:z.control,name:"amountMaxFilter",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"أقصى مبلغ"}),(0,s.jsx)(u.p,{type:"number",placeholder:"1000.00",value:void 0===T?"":String(T),onChange:e=>I(""===e.target.value?void 0:parseFloat(e.target.value))})]})})]}),(0,s.jsx)(m.zB,{control:z.control,name:"currencyFilter",render:()=>(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"العملة"}),(0,s.jsxs)(ee,{children:[(0,s.jsx)(et,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",className:"w-full justify-between text-start",children:[(0,s.jsx)("span",{children:0===O.size?"جميع العملات":"".concat(O.size," عملات مختارة")}),(0,s.jsx)(H.A,{className:"h-4 w-4 opacity-50"})]})}),(0,s.jsxs)(ea,{align:"start",className:"w-[var(--radix-dropdown-menu-trigger-width)] max-h-60 overflow-y-auto",children:[(0,s.jsx)(er,{children:"اختر العملات"}),(0,s.jsx)(en,{}),R.HE.map(e=>(0,s.jsxs)(es,{checked:O.has(e.code),onCheckedChange:()=>F(e.code),children:[e.name," (",e.symbol,")"]},e.code))]})]})]})})]})}),(0,s.jsxs)(el.Es,{children:[(0,s.jsx)(c.$,{variant:"outline",onClick:()=>{y(void 0),N(void 0),w(new Set),E(""),A(void 0),I(void 0),_(new Set)},children:"مسح الفلاتر"}),(0,s.jsx)(c.$,{onClick:()=>j(!1),children:"تطبيق"})]})]})]})]}),(0,s.jsx)(k.Wu,{children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(M,{children:[(0,s.jsx)(G,{children:(0,s.jsxs)(V,{children:[(0,s.jsxs)(U,{onClick:()=>P("date"),className:"cursor-pointer hover:bg-accent text-start whitespace-nowrap",children:["التاريخ ",(0,s.jsx)(Y.A,{className:"me-2 h-4 w-4 inline ".concat("date"===l?"opacity-100":"opacity-50")})]}),(0,s.jsxs)(U,{onClick:()=>P("type"),className:"cursor-pointer hover:bg-accent text-start whitespace-nowrap",children:["النوع ",(0,s.jsx)(Y.A,{className:"me-2 h-4 w-4 inline ".concat("type"===l?"opacity-100":"opacity-50")})]}),(0,s.jsxs)(U,{onClick:()=>P("description"),className:"cursor-pointer hover:bg-accent text-start",children:["الوصف ",(0,s.jsx)(Y.A,{className:"me-2 h-4 w-4 inline ".concat("description"===l?"opacity-100":"opacity-50")})]}),(0,s.jsxs)(U,{onClick:()=>P("amount"),className:"text-end cursor-pointer hover:bg-accent whitespace-nowrap",children:["المبلغ ",(0,s.jsx)(Y.A,{className:"me-2 h-4 w-4 inline ".concat("amount"===l?"opacity-100":"opacity-50")})]}),(0,s.jsxs)(U,{onClick:()=>P("currency"),className:"cursor-pointer hover:bg-accent text-start whitespace-nowrap",children:["العملة ",(0,s.jsx)(Y.A,{className:"me-2 h-4 w-4 inline ".concat("currency"===l?"opacity-100":"opacity-50")})]}),(0,s.jsx)(U,{className:"text-end whitespace-nowrap",children:"الإجراءات"})]})}),(0,s.jsx)(L,{children:K.length>100?(0,s.jsx)(B.Y1,{height:450,itemCount:K.length,itemSize:48,width:"100%",itemData:{transactions:K,onEditTransactionRequest:n,onDeleteTransaction:a},children:e=>{var t;let{index:a,style:r,data:n}=e,l=n.transactions[a];return(0,s.jsxs)(V,{style:r,children:[(0,s.jsx)(J,{className:"text-start whitespace-nowrap",children:(0,i.GP)(new Date(l.date),"PP",{locale:p.G})}),(0,s.jsx)(J,{className:"text-start whitespace-nowrap",children:ei(l.type)}),(0,s.jsx)(J,{className:"font-medium text-start",children:l.description}),(0,s.jsx)(J,{className:"text-end whitespace-nowrap",children:Q(l.amount,l.currency)}),(0,s.jsx)(J,{className:"text-start whitespace-nowrap",children:(null==(t=(0,R.So)(l.currency))?void 0:t.name)||l.currency}),(0,s.jsxs)(J,{className:"text-end space-x-1 whitespace-nowrap",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>n.onEditTransactionRequest(l),"aria-label":"تعديل المعاملة",children:(0,s.jsx)(q.A,{className:"h-4 w-4 text-blue-500"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>n.onDeleteTransaction(l.id),"aria-label":"حذف المعاملة",children:(0,s.jsx)(W.A,{className:"h-4 w-4 text-destructive"})})]})]},l.id)}}):(0,s.jsxs)(s.Fragment,{children:[K.map(e=>{var t;return(0,s.jsxs)(V,{children:[(0,s.jsx)(J,{className:"text-start whitespace-nowrap",children:(0,i.GP)(new Date(e.date),"PP",{locale:p.G})}),(0,s.jsx)(J,{className:"text-start whitespace-nowrap",children:ei(e.type)}),(0,s.jsx)(J,{className:"font-medium text-start",children:e.description}),(0,s.jsx)(J,{className:"text-end whitespace-nowrap",children:Q(e.amount,e.currency)}),(0,s.jsx)(J,{className:"text-start whitespace-nowrap",children:(null==(t=(0,R.So)(e.currency))?void 0:t.name)||e.currency}),(0,s.jsxs)(J,{className:"text-end space-x-1 whitespace-nowrap",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>n(e),"aria-label":"تعديل المعاملة",children:(0,s.jsx)(q.A,{className:"h-4 w-4 text-blue-500"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>a(e.id),"aria-label":"حذف المعاملة",children:(0,s.jsx)(W.A,{className:"h-4 w-4 text-destructive"})})]})]},e.id)}),0===K.length&&(0,s.jsx)(V,{children:(0,s.jsx)(J,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"لا توجد معاملات تطابق معايير التصفية الحالية."})})]})})]})})})]})});var eo=a(4271),ed=a(9591),ec=a(9876),em=a(9114),eu=a(5166),ex=a(4815),ep=a(4448),eh=a(7489);let ef=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:n=!0,...l}=e;return(0,s.jsx)(eh.b,{ref:t,decorative:n,orientation:r,className:(0,f.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...l})});function ej(e){let{transactions:t,exchangeRates:a,destinationType:n}=e,l=r.useMemo(()=>n===A.bE.INTERNAL?[R.Sj.EGP]:n===A.bE.EXTERNAL?[R.Sj.EGP,R.Sj.USD,R.Sj.AED]:R.dD,[n]),i=r.useMemo(()=>{let e={};return l.forEach(s=>{let r=0,n=0,l=0,i=0,o=[],d=[],c=[],m=[];t.forEach(e=>{let t=e.type,u=(0,eo.hZ)(e.amount,e.currency,s,a),x={originalCurrency:e.currency,originalAmount:e.amount,convertedAmount:u,type:e.type};t===A.D_.REVENUE||t===A.D_.CUSTODY_HANDOVER_CLIENT?(r+=u,o.push(x)):t===A.D_.EXPENSE?(n+=u,d.push(x)):t===A.D_.CUSTODY_HANDOVER_OWNER?(l+=u,c.push(x)):t===A.D_.DRIVER_FEE&&(i+=u,m.push(x))}),e[s]={revenueAndClientCustody:r,revenueAndClientCustodyDetails:o,expense:n,expenseDetails:d,custodyOwner:l,custodyOwnerDetails:c,driverFee:i,driverFeeDetails:m}}),e},[t,a,l]),o=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=(0,R.So)(t),n=e.toLocaleString("ar",{minimumFractionDigits:2,maximumFractionDigits:2}),l="";switch(a){case"positive":l="text-[hsl(var(--positive-balance-fg))]";break;case"negative":l="text-[hsl(var(--negative-balance-fg))]";break;case"neutral":l="text-foreground";break;default:l=e>=0?"text-[hsl(var(--positive-balance-fg))]":"text-[hsl(var(--negative-balance-fg))]"}return(0,s.jsxs)("span",{className:(0,f.cn)(l,"whitespace-nowrap font-semibold"),children:[(null==r?void 0:r.symbol)||"",n]})},d=(e,t)=>0===e.length?null:(0,s.jsx)("div",{className:"ps-6 pe-2 mt-1 text-xs text-muted-foreground space-y-0.5 border-s border-dashed border-primary/50 ms-2",children:e.map((e,r)=>{var n;let l="↳ من";return e.type===A.D_.CUSTODY_HANDOVER_CLIENT?l="↳ عهدة عميل من":e.type===A.D_.REVENUE?l="↳ إيراد من":e.type===A.D_.CUSTODY_HANDOVER_OWNER&&(l="↳ عهدة مالك من"),(0,s.jsxs)("div",{className:"flex flex-col items-start sm:flex-row sm:justify-between sm:items-center py-0.5",children:[(0,s.jsxs)("span",{className:"whitespace-nowrap",children:[l," ",(null==(n=(0,R.So)(e.originalCurrency))?void 0:n.name)||e.originalCurrency,": ",o(e.originalAmount,e.originalCurrency,"neutral")]}),(0,s.jsxs)("span",{className:"whitespace-nowrap text-start sm:text-end",children:["(يعادل ",o(e.convertedAmount,t,"neutral")," ",(0,s.jsxs)("span",{className:"text-xs text-muted-foreground/70",dir:"ltr",children:["@",(0,eo.Ej)(e.originalCurrency,t,a).toFixed(4)]}),")"]})]},r)})}),c=(e,t)=>{if(0===e.length)return null;let r=new Map;return(e.forEach(e=>{let t=r.get(e.originalCurrency);t?(t.totalOriginal+=e.originalAmount,t.totalConverted+=e.convertedAmount):r.set(e.originalCurrency,{totalOriginal:e.originalAmount,totalConverted:e.convertedAmount})}),0===r.size)?null:(0,s.jsx)("div",{className:"ps-6 pe-2 mt-1 text-xs text-muted-foreground space-y-0.5 border-s border-dashed border-primary/50 ms-2",children:Array.from(r.entries()).map((e,r)=>{var n;let[l,i]=e;return(0,s.jsxs)("div",{className:"flex flex-col items-start sm:flex-row sm:justify-between sm:items-center py-0.5",children:[(0,s.jsxs)("span",{className:"whitespace-nowrap",children:["↳ منها بالـ",(null==(n=(0,R.So)(l))?void 0:n.name)||l,": ",o(i.totalOriginal,l,"neutral")]}),(0,s.jsxs)("span",{className:"whitespace-nowrap text-start sm:text-end",children:["(يعادل ",o(i.totalConverted,t,"neutral")," ",(0,s.jsxs)("span",{className:"text-xs text-muted-foreground/70",dir:"ltr",children:["@",(0,eo.Ej)(l,t,a).toFixed(4)]}),")"]})]},r)})})};return t.length>0?(0,s.jsxs)(k.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(k.aR,{children:[(0,s.jsxs)(k.ZB,{className:"flex items-center text-xl",children:[(0,s.jsx)(ec.A,{className:"ms-2 h-7 w-7 text-primary"}),"ملخص ربحية الرحلات"]}),(0,s.jsx)(k.BT,{children:"تحليل إجمالي الإيرادات (متضمنًا العهد من العملاء ومن المالك)، المصروفات، وأجرة السائق المحولة لعملات رئيسية لتحديد ربحية الرحلات."})]}),(0,s.jsx)(k.Wu,{className:"space-y-6",children:l.map(e=>{let t=i[e];if(!t)return null;let a=(0,R.So)(e),r=(null==a?void 0:a.name)||e,n=(null==a?void 0:a.symbol)||e,l=t.revenueAndClientCustody+t.custodyOwner,m=l-t.expense,u=m-t.driverFee,x=u-t.custodyOwner;return(0,s.jsxs)(k.Zp,{className:"shadow-md",children:[(0,s.jsx)(k.aR,{children:(0,s.jsxs)(k.ZB,{className:"text-lg text-center",children:["تفصيل العمليات بالـ",r," (",n,")"]})}),(0,s.jsxs)(k.Wu,{className:"space-y-3 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"font-medium",children:[(0,s.jsx)(em.A,{className:"inline h-4 w-4 me-1.5 text-primary"}),"إجمالي إيرادات الرحلات والعهد من العملاء:"]}),o(t.revenueAndClientCustody,e,"positive")]}),d(t.revenueAndClientCustodyDetails,e),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,s.jsxs)("span",{className:"font-medium",children:[(0,s.jsx)(eu.A,{className:"inline h-4 w-4 me-1.5 text-primary"}),"يُضاف: العهدة المستلمة من المالك:"]}),o(t.custodyOwner,e,"positive")]}),d(t.custodyOwnerDetails,e),(0,s.jsx)(ef,{className:"my-3"}),(0,s.jsxs)("div",{className:"flex justify-between items-center font-semibold text-base",children:[(0,s.jsx)("span",{children:"المجموع الفرعي (الإيرادات والعهد الإجمالية):"}),o(l,e,"default")]}),(0,s.jsx)(ef,{className:"my-3"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"font-medium",children:[(0,s.jsx)(ex.A,{className:"inline h-4 w-4 me-1.5 text-primary"}),"يُطرح: إجمالي المصروفات:"]}),o(t.expense,e,"negative")]}),c(t.expenseDetails,e),(0,s.jsx)(ef,{className:"my-3"}),(0,s.jsxs)("div",{className:"flex justify-between items-center font-semibold text-base",children:[(0,s.jsx)("span",{children:"صافي الربح قبل أجرة السائق:"}),o(m,e,"default")]}),(0,s.jsx)(ef,{className:"my-3"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"font-medium",children:[(0,s.jsx)(ep.A,{className:"inline h-4 w-4 me-1.5 text-primary"}),"يُطرح: أجرة السائق:"]}),o(t.driverFee,e,"negative")]}),c(t.driverFeeDetails,e),(0,s.jsx)(ef,{className:"my-3.5 border-primary/60"}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-md font-semibold",children:[(0,s.jsx)("span",{children:"الربح/الخسارة التشغيلية (قبل تسوية عهدة المالك):"}),o(u,e,"default")]}),(0,s.jsx)(ef,{className:"my-3"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"font-medium",children:[(0,s.jsx)(eu.A,{className:"inline h-4 w-4 me-1.5 text-primary"}),"يُخصم: عهدة المالك (لتسوية الربح):"]}),o(t.custodyOwner,e,"negative")]}),d(t.custodyOwnerDetails,e),(0,s.jsx)(ef,{className:"my-4 border-accent"}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-lg",children:[(0,s.jsx)("span",{className:"font-bold text-[hsl(var(--primary))]",children:"صافي ربح/خسارة الرحلة النهائي (بعد تسوية عهدة المالك):"}),o(x,e,"default")]})]})]},"profit-loss-".concat(e))})})]}):(0,s.jsxs)(k.Zp,{className:"shadow-lg",children:[(0,s.jsx)(k.aR,{children:(0,s.jsxs)(k.ZB,{className:"flex items-center",children:[(0,s.jsx)(ed.A,{className:"ms-2 h-6 w-6 text-primary"}),"ملخص الأرصدة"]})}),(0,s.jsx)(k.Wu,{children:(0,s.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"لا توجد أرصدة لعرضها بعد."})})]})}ef.displayName=eh.b.displayName;let eg=e=>e.toLocaleString("ar-EG",{minimumFractionDigits:2,maximumFractionDigits:2}),ey=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"neutral",r=(0,R.So)(t),n=eg(e),l="print-text-neutral";return"positive"===a?l="print-text-positive":"negative"===a&&(l="print-text-negative"),(0,s.jsxs)("span",{className:(0,f.cn)(l,"font-semibold"),children:[(null==r?void 0:r.symbol)||t,n]})};function ev(e){let{transactions:t,exchangeRates:a,tripDetails:n}=e,[l,o]=r.useState(null);r.useEffect(()=>{o(new Date)},[]);let d=r.useMemo(()=>{let e={};return t.filter(e=>e.type===A.D_.EXPENSE).forEach(t=>{e[t.currency]||(e[t.currency]={total:0,details:[]}),e[t.currency].total+=t.amount,e[t.currency].details.push({description:t.description,amount:t.amount})}),e},[t]),c=r.useMemo(()=>{let e={};return R.dD.forEach(s=>{let r=0,n=0,l=0,i=0,o=[],d=[],c=[],m=[];t.forEach(e=>{let t=e.type,u=(0,eo.hZ)(e.amount,e.currency,s,a),x={originalCurrency:e.currency,originalAmount:e.amount,convertedAmount:u,type:e.type};t===A.D_.REVENUE||t===A.D_.CUSTODY_HANDOVER_CLIENT?(r+=u,o.push(x)):t===A.D_.EXPENSE?(n+=u,d.push(x)):t===A.D_.CUSTODY_HANDOVER_OWNER?(l+=u,c.push(x)):t===A.D_.DRIVER_FEE&&(i+=u,m.push(x))}),e[s]={revenueAndClientCustody:r,revenueAndClientCustodyDetails:o,expense:n,expenseDetails:d,custodyOwner:l,custodyOwnerDetails:c,driverFee:i,driverFeeDetails:m}}),e},[t,a]),m=(e,t)=>0===e.length?(0,s.jsx)("div",{className:"ps-6 pe-2 mt-1 text-xs text-gray-500",children:"لا توجد تفاصيل لهذه الفئة."}):(0,s.jsx)("div",{className:"ps-6 pe-2 mt-1 text-xs text-gray-600 space-y-0.5 border-s border-dashed border-gray-300 ms-2",children:e.map((e,r)=>{var n;let l="↳ من";return e.type===A.D_.CUSTODY_HANDOVER_CLIENT?l="↳ عهدة عميل من":e.type===A.D_.REVENUE?l="↳ إيراد من":e.type===A.D_.CUSTODY_HANDOVER_OWNER&&(l="↳ عهدة مالك من"),(0,s.jsxs)("div",{className:"flex justify-between items-center py-0.5",children:[(0,s.jsxs)("span",{className:"whitespace-nowrap",children:[l," ",(null==(n=(0,R.So)(e.originalCurrency))?void 0:n.name)||e.originalCurrency,": ",ey(e.originalAmount,e.originalCurrency,"neutral")]}),(0,s.jsxs)("span",{className:"whitespace-nowrap text-end",children:["(يعادل ",ey(e.convertedAmount,t,"neutral")," ",(0,s.jsxs)("span",{className:"text-xs text-gray-500",dir:"ltr",children:["@",(0,eo.Ej)(e.originalCurrency,t,a).toFixed(4)]}),")"]})]},r)})}),u=(e,t)=>{if(0===e.length)return(0,s.jsx)("div",{className:"ps-6 pe-2 mt-1 text-xs text-gray-500",children:"لا توجد تفاصيل لهذه الفئة."});let r=new Map;return(e.forEach(e=>{let t=r.get(e.originalCurrency);t?(t.totalOriginal+=e.originalAmount,t.totalConverted+=e.convertedAmount):r.set(e.originalCurrency,{totalOriginal:e.originalAmount,totalConverted:e.convertedAmount})}),0===r.size)?null:(0,s.jsx)("div",{className:"ps-6 pe-2 mt-1 text-xs text-gray-600 space-y-0.5 border-s border-dashed border-gray-300 ms-2",children:Array.from(r.entries()).map((e,r)=>{var n;let[l,i]=e;return(0,s.jsxs)("div",{className:"flex justify-between items-center py-0.5",children:[(0,s.jsxs)("span",{className:"whitespace-nowrap",children:["↳ منها بالـ",(null==(n=(0,R.So)(l))?void 0:n.name)||l,": ",ey(i.totalOriginal,l,"neutral")]}),(0,s.jsxs)("span",{className:"whitespace-nowrap text-end",children:["(يعادل ",ey(i.totalConverted,t,"neutral")," ",(0,s.jsxs)("span",{className:"text-xs text-gray-500",dir:"ltr",children:["@",(0,eo.Ej)(l,t,a).toFixed(4)]}),")"]})]},r)})})};return(0,s.jsxs)("div",{id:"printable-content",className:"p-4 bg-white text-black",dir:"rtl",children:[(0,s.jsx)("h1",{className:"printable-title text-center mb-2",children:"تقرير المعاملات والربحية"}),n&&(0,s.jsxs)("div",{className:"text-center mb-2 text-sm text-gray-700",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"السائق:"})," ",n.driverName]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"الوجهة:"})," ","INTERNAL"===n.destinationType?n.cityName:n.countryName]}),(()=>{if(n.tripStartDate&&n.tripEndDate){let e=n.tripStartDate instanceof Date?n.tripStartDate:new Date(n.tripStartDate),t=n.tripEndDate instanceof Date?n.tripEndDate:new Date(n.tripEndDate);if(!isNaN(e.getTime())&&!isNaN(t.getTime()))return(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"الفترة:"})," من ",(0,i.GP)(e,"PP",{locale:p.G})," إلى ",(0,i.GP)(t,"PP",{locale:p.G})]})}return(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"الفترة:"})," (التواريخ غير محددة أو غير صالحة)"]})})()]}),l&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mb-4 text-center",children:["تاريخ إنشاء التقرير: ",(0,i.GP)(l,"PPPpp",{locale:p.G})]}),(0,s.jsxs)("section",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"printable-section-title",children:"ملخص المصروفات المفصل حسب العملة"}),Object.keys(d).length>0?Object.entries(d).map(e=>{var t,a;let[r,n]=e;return(0,s.jsxs)("div",{className:"mb-4 p-3 printable-card",children:[(0,s.jsxs)("h3",{className:"font-semibold text-base mb-1.5",children:["المصروفات بعملة: ",(null==(t=(0,R.So)(r))?void 0:t.name)||r]}),(0,s.jsxs)("table",{className:"printable-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"الوصف"}),(0,s.jsx)("th",{className:"text-end",children:"المبلغ"})]})}),(0,s.jsx)("tbody",{children:n.details.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.description}),(0,s.jsx)("td",{className:"text-end",children:ey(e.amount,r,"negative")})]},t))}),(0,s.jsx)("tfoot",{children:(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"font-bold",children:["إجمالي المصروفات بـ",(null==(a=(0,R.So)(r))?void 0:a.symbol)||r]}),(0,s.jsx)("td",{className:"text-end font-bold",children:ey(n.total,r,"negative")})]})})]})]},r)}):(0,s.jsx)("p",{className:"text-gray-600",children:"لا توجد مصروفات مسجلة."})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"printable-section-title",children:"ملخص ربحية الرحلات (معادل)"}),R.dD.map(e=>{var t;let a=c[e];if(!a)return null;let r=(null==(t=(0,R.So)(e))?void 0:t.name)||e,n=a.revenueAndClientCustody+a.custodyOwner,l=n-a.expense,i=l-a.driverFee,o=i-a.custodyOwner;return(0,s.jsxs)("div",{className:"mb-6 p-3 printable-card",children:[(0,s.jsxs)("h3",{className:"font-semibold text-base mb-2 text-center border-b pb-1.5 border-gray-300",children:["تفصيل العمليات بالـ",r]}),(0,s.jsxs)("div",{className:"space-y-1.5 text-xs",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"إجمالي إيرادات الرحلات والعهد من العملاء:"}),ey(a.revenueAndClientCustody,e,"positive")]}),m(a.revenueAndClientCustodyDetails,e),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-1.5",children:[(0,s.jsx)("span",{children:"يُضاف: العهدة المستلمة من المالك:"}),ey(a.custodyOwner,e,"positive")]}),m(a.custodyOwnerDetails,e),(0,s.jsx)("hr",{className:"my-2 border-gray-300"}),(0,s.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,s.jsx)("span",{children:"المجموع الفرعي (الإيرادات والعهد الإجمالية):"}),ey(n,e,"neutral")]}),(0,s.jsx)("hr",{className:"my-2 border-gray-300"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"يُطرح: إجمالي المصروفات:"}),ey(a.expense,e,"negative")]}),u(a.expenseDetails,e),(0,s.jsx)("hr",{className:"my-2 border-gray-300"}),(0,s.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,s.jsx)("span",{children:"صافي الربح قبل أجرة السائق:"}),ey(l,e,"neutral")]}),(0,s.jsx)("hr",{className:"my-2 border-gray-300"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"يُطرح: أجرة السائق:"}),ey(a.driverFee,e,"negative")]}),u(a.driverFeeDetails,e),(0,s.jsx)("hr",{className:"my-2.5 border-gray-400"}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm pt-0.5 font-semibold",children:[(0,s.jsx)("span",{children:"الربح/الخسارة التشغيلية (قبل تسوية عهدة المالك):"}),ey(i,e,"neutral")]}),(0,s.jsx)("hr",{className:"my-2 border-gray-300"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"يُخصم: عهدة المالك (لتسوية الربح):"}),ey(a.custodyOwner,e,"negative")]}),m(a.custodyOwnerDetails,e),(0,s.jsx)("hr",{className:"my-2.5 border-gray-500"}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-base pt-0.5 font-bold",children:[(0,s.jsx)("span",{children:"صافي ربح/خسارة الرحلة النهائي (بعد تسوية عهدة المالك):"}),ey(o,e,"neutral")]})]})]},"profit-loss-print-".concat(e))})]})]})}var eN=a(4059);let eb=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.bL,{className:(0,f.cn)("grid gap-2",a),...r,ref:t})});eb.displayName=eN.bL.displayName;let ew=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.q7,{ref:t,className:(0,f.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...r,children:(0,s.jsx)(eN.C1,{className:"flex items-center justify-center",children:(0,s.jsx)(Q.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});ew.displayName=eN.q7.displayName;var eS=a(1133);function eD(){return(0,s.jsx)(eS.A,{className:"inline-block text-red-500 w-4 h-4 mr-1 align-middle","aria-hidden":"true"})}var eE=a(8310);function eC(e){let{label:t,onFilesChange:a,accept:n,multiple:l=!1,value:i}=e,o=r.useRef(null),d=r.useId();return(0,s.jsxs)("div",{children:[t&&(0,s.jsx)("label",{htmlFor:d,className:"block mb-1 font-medium",children:t}),(0,s.jsx)("input",{id:d,ref:o,type:"file",accept:n,multiple:l,onChange:e=>{a(e.target.files?Array.from(e.target.files):[])},className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-zinc-800 dark:file:text-blue-200 dark:hover:file:bg-zinc-700","aria-label":t?void 0:"رفع ملفات",title:t||"رفع ملفات",placeholder:"اختر ملفات..."}),i&&i.length>0&&(0,s.jsx)("ul",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300",children:i.map((e,t)=>(0,s.jsx)("li",{children:e.name},t))})]})}let eR=r.forwardRef((e,t)=>{var a;let{suggestions:n,onSelectSuggestion:l,...i}=e,[o,d]=r.useState(!1),[c,m]=r.useState([]),[x,p]=r.useState(-1),[h,f]=r.useState((null==(a=i.value)?void 0:a.toString())||""),j=r.useRef(null);r.useEffect(()=>{var e;f((null==(e=i.value)?void 0:e.toString())||"")},[i.value]);let g=e=>{var t;f(e),d(!1),p(-1),null==l||l(e),null==(t=i.onChange)||t.call(i,{target:{value:e}})};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.p,{...i,ref:e=>{j.current=e,t&&("function"==typeof t?t(e):t.current=e)},value:h,autoComplete:"off",onChange:e=>{var t;let a=e.target.value;if(f(a),a){let e=n.filter(e=>e.toLowerCase().includes(a.toLowerCase()));m(e),d(e.length>0)}else d(!1),m([]);null==(t=i.onChange)||t.call(i,e)},onFocus:()=>d(c.length>0),onBlur:()=>setTimeout(()=>d(!1),100),onKeyDown:e=>{o&&("ArrowDown"===e.key?p(e=>e<c.length-1?e+1:e):"ArrowUp"===e.key?p(e=>e>0?e-1:e):"Enter"===e.key&&x>=0?g(c[x]):"Escape"===e.key&&d(!1))}}),o&&c.length>0&&(0,s.jsx)("ul",{className:"absolute z-10 left-0 right-0 bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-700 rounded shadow mt-1 max-h-40 overflow-y-auto",children:c.map((e,t)=>(0,s.jsx)("li",{className:"px-3 py-1 cursor-pointer ".concat(t===x?"bg-blue-100 dark:bg-zinc-700":""),onMouseDown:()=>g(e),onMouseEnter:()=>p(t),children:e},e))})]})});eR.displayName="AutocompleteInput";let eA=()=>({driverName:"",destinationType:A.bE.INTERNAL,cityName:"",countryName:"",tripStartDate:void 0,tripEndDate:void 0}),eT=r.forwardRef((e,t)=>{let{onDetailsSubmit:a,initialData:n,onCancelEdit:l}=e,[i,x]=r.useState([]),{toast:p}=(0,E.dj)(),[h,f]=r.useState(!1),j="pettycash_trip_details_draft",g=(0,d.mN)({resolver:(0,o.u)(I),mode:"onChange",reValidateMode:"onChange",defaultValues:n||eA()});r.useEffect(()=>{if(n)g.reset({...n,tripStartDate:n.tripStartDate?new Date(n.tripStartDate):new Date,tripEndDate:n.tripEndDate?new Date(n.tripEndDate):new Date});else{let e=localStorage.getItem(j);if(e)try{let t=JSON.parse(e);g.reset({...eA(),...t,tripStartDate:t.tripStartDate?new Date(t.tripStartDate):new Date,tripEndDate:t.tripEndDate?new Date(t.tripEndDate):new Date})}catch(e){}else g.reset({...eA(),tripStartDate:new Date,tripEndDate:new Date})}},[n,g.reset,g]),r.useEffect(()=>{let e=g.watch(e=>{if(e.driverName||e.cityName||e.countryName){let t={...e};t.tripStartDate instanceof Date&&(t.tripStartDate=t.tripStartDate.toISOString()),t.tripEndDate instanceof Date&&(t.tripEndDate=t.tripEndDate.toISOString()),localStorage.setItem(j,JSON.stringify(t))}});return()=>e.unsubscribe()},[g]),r.useImperativeHandle(t,()=>({validateAndGetData:async()=>await g.trigger()?g.getValues():null,resetForm:e=>{localStorage.removeItem(j);let t=eA();g.reset(e||{...t,tripStartDate:new Date,tripEndDate:new Date})}}));let y=g.watch("destinationType");async function v(e){f(!0),localStorage.removeItem(j),a(e),p({title:"تم تحديث بيانات الرحلة مؤقتًا",description:"تم تحديث بيانات رحلة السائق ".concat(e.driverName,' محليًا. اضغط "حفظ الرحلة بالكامل" في الأسفل لحفظ كل شيء.')}),f(!1)}let N=r.useCallback(()=>{let e=Object.keys(g.formState.errors);if(e.length>0){let t=document.querySelector("[name='".concat(e[0],"']"));t&&"function"==typeof t.scrollIntoView&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus())}},[g.formState.errors]);(0,eE.vC)("enter",e=>{var t;document.activeElement&&(null==(t=document.activeElement)?void 0:t.form)&&(e.preventDefault(),g.handleSubmit(v)())},{enableOnFormTags:!0},[g]),(0,eE.vC)("esc",e=>{e.preventDefault(),l?l():g.reset()},{enableOnFormTags:!0},[g,l]);let b=g.watch("driverName"),w=g.watch("cityName"),S=g.watch("countryName"),C=g.watch("tripStartDate"),R=g.watch("tripEndDate");function T(e){if(!e)return"-";try{return("string"==typeof e?new Date(e):e).toLocaleDateString("ar-EG")}catch(e){return"-"}}return(0,s.jsxs)(s.Fragment,{children:[r.useMemo(()=>(0,s.jsxs)(k.Zp,{className:"mb-4 bg-blue-50 dark:bg-zinc-800 border-blue-200 dark:border-zinc-700 text-blue-900 dark:text-blue-100","aria-hidden":"true",tabIndex:-1,children:[(0,s.jsx)(k.aR,{className:"pb-2",children:(0,s.jsx)(k.ZB,{className:"text-base font-semibold",children:"ملخص الرحلة الحالي"})}),(0,s.jsxs)(k.Wu,{className:"flex flex-col gap-1 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"السائق:"})," ",b||(0,s.jsx)("span",{className:"text-gray-400",children:"غير محدد"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"الوجهة:"})," ",y===A.bE.INTERNAL?w||(0,s.jsx)("span",{className:"text-gray-400",children:"مدينة غير محددة"}):S||(0,s.jsx)("span",{className:"text-gray-400",children:"بلد غير محدد"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"تاريخ البدء:"})," ",T(C),(0,s.jsx)("span",{className:"mx-2",children:"|"}),(0,s.jsx)("span",{className:"font-medium",children:"تاريخ النهاية:"})," ",T(R)]})]})]}),[b,y,w,S,C,R]),(0,s.jsxs)(k.Zp,{className:"shadow-lg no-print",children:[(0,s.jsxs)(k.aR,{children:[(0,s.jsx)(k.ZB,{children:"بيانات الرحلة"}),(0,s.jsx)(k.BT,{children:'أدخل تفاصيل الرحلة هنا. يمكنك الضغط على "تحديث بيانات الرحلة" لتأكيدها مؤقتًا، أو حفظ الرحلة بأكملها مباشرة بالزر في الأسفل.'})]}),(0,s.jsx)(k.Wu,{children:(0,s.jsx)(m.lV,{...g,children:(0,s.jsxs)("form",{onSubmit:g.handleSubmit(v,N),className:"space-y-6",children:[(0,s.jsx)(m.zB,{control:g.control,name:"driverName",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsxs)(m.lR,{children:["اسم السائق",g.formState.errors.driverName&&(0,s.jsx)(eD,{})]}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(u.p,{placeholder:"ادخل اسم السائق","aria-label":"اسم السائق",...t})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(m.zB,{control:g.control,name:"tripStartDate",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{className:"flex flex-col",children:[(0,s.jsxs)(m.lR,{children:["تاريخ بدء الرحلة",g.formState.errors.tripStartDate&&(0,s.jsx)(eD,{})]}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(D,{date:t.value,setDate:t.onChange})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:g.control,name:"tripEndDate",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{className:"flex flex-col",children:[(0,s.jsxs)(m.lR,{children:["تاريخ نهاية الرحلة",g.formState.errors.tripEndDate&&(0,s.jsx)(eD,{})]}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(D,{date:t.value,setDate:t.onChange})}),(0,s.jsx)(m.C5,{})]})}})]}),(0,s.jsx)(m.zB,{control:g.control,name:"destinationType",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{className:"space-y-3",children:[(0,s.jsxs)(m.lR,{children:["الوجهة",g.formState.errors.destinationType&&(0,s.jsx)(eD,{})]}),(0,s.jsx)(m.MJ,{children:(0,s.jsxs)(eb,{onValueChange:e=>{t.onChange(e),e===A.bE.INTERNAL?(g.setValue("countryName",""),g.getValues("cityName")||g.trigger("cityName")):(g.setValue("cityName",""),g.getValues("countryName")||g.trigger("countryName"))},value:t.value,className:"flex flex-col space-y-1 md:flex-row md:space-y-0 md:space-x-4 md:space-x-reverse",children:[(0,s.jsxs)(m.eI,{className:"flex items-center space-x-2 space-x-reverse",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(ew,{value:A.bE.INTERNAL})}),(0,s.jsx)(m.lR,{className:"font-normal",children:"داخل البلاد"})]}),(0,s.jsxs)(m.eI,{className:"flex items-center space-x-2 space-x-reverse",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(ew,{value:A.bE.EXTERNAL})}),(0,s.jsx)(m.lR,{className:"font-normal",children:"خارج البلاد"})]})]})}),(0,s.jsx)(m.C5,{})]})}}),y===A.bE.INTERNAL&&(0,s.jsx)(m.zB,{control:g.control,name:"cityName",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsxs)(m.lR,{children:["اسم المدينة",g.formState.errors.cityName&&(0,s.jsx)(eD,{})]}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(eR,{placeholder:"ادخل اسم المدينة","aria-label":"اسم المدينة",suggestions:["القاهرة","الإسكندرية","أسوان","الأقصر","الغردقة","شرم الشيخ","المنصورة","الفيوم","سوهاج","دمياط","طنطا","أسيوط","الزقازيق","دمنهور"],...t,value:t.value||"",onChange:e=>t.onChange(e.target.value)})}),(0,s.jsx)(m.C5,{})]})}}),y===A.bE.EXTERNAL&&(0,s.jsx)(m.zB,{control:g.control,name:"countryName",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsxs)(m.lR,{children:["اسم البلد",g.formState.errors.countryName&&(0,s.jsx)(eD,{})]}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(eR,{placeholder:"ادخل اسم البلد","aria-label":"اسم البلد",suggestions:["مصر","السعودية","الإمارات","الأردن","الكويت","قطر","تركيا","لبنان","المغرب","تونس","الجزائر","السودان","اليمن","عمان","سوريا","العراق"],...t,value:t.value||"",onChange:e=>t.onChange(e.target.value)})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)("hr",{className:"my-4 border-blue-200 dark:border-zinc-700"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block mb-1 font-semibold text-blue-900 dark:text-blue-100",children:"المرفقات"}),(0,s.jsx)(eC,{label:"إرفاق مستندات أو صور (اختياري)",multiple:!0,accept:"image/*,application/pdf",onFilesChange:e=>x(e),value:i,"aria-label":"إرفاق مستندات أو صور"}),h&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-blue-600 dark:text-blue-200 text-xs",children:[(0,s.jsx)(z.A,{className:"animate-spin w-4 h-4"})," جاري رفع الملفات..."]})]}),(0,s.jsxs)(c.$,{type:"submit",className:"w-full",disabled:h,children:[h&&(0,s.jsx)(z.A,{className:"ms-2 h-4 w-4 animate-spin"}),"تحديث بيانات الرحلة (مؤقتًا)"]})]})})})]})]})});eT.displayName="TripDetailsForm";var eI=a(8763),eO=a(9119),e_=a(9968),ez=a(8271),ek=a(8018),eP=a(960),eF=a(5057),eM=a(7554);async function eG(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.Sj.EGP,t="3a1cb24f14c33d34db26023a";if(!t)throw Error("ExchangeRate API key is missing");let a="".concat("https://v6.exchangerate-api.com/v6","/").concat(t,"/latest/").concat(e),s=await fetch(a,{next:{revalidate:3600}});if(!s.ok)throw Error("ExchangeRate API error: ".concat(s.status));let r=(await s.json()).conversion_rates,n={};for(let[e,t]of Object.entries(r))t>0&&(n[e]=1/t);return n[R.Sj.EGP]=1,n}let eL=[(0,R.So)(R.Sj.EGP),(0,R.So)(R.Sj.USD),(0,R.So)(R.Sj.SAR),(0,R.So)(R.Sj.AED),(0,R.So)(R.Sj.JOD),(0,R.So)(R.Sj.SYP),(0,R.So)(R.Sj.SDG)],eV={[R.Sj.EGP]:1,[R.Sj.USD]:30,[R.Sj.SAR]:8,[R.Sj.AED]:8.3,[R.Sj.JOD]:42,[R.Sj.SYP]:.006,[R.Sj.SDG]:.09};function eU(e){let{isOpen:t,onOpenChange:a,currentRates:n,onRatesUpdate:l}=e,[i,o]=r.useState({}),[d,m]=r.useState(!1),[x,p]=r.useState(!1),[h,f]=r.useState("يمكنك جلب أسعار الصرف مقابل الجنيه المصري أو تعديلها يدوياً."),[j,g]=r.useState(new Date),{toast:y}=(0,E.dj)();r.useEffect(()=>{if(t){let e={};eL.forEach(t=>{let a=t.code;if(a===R.Sj.EGP)e[a]="1";else{var s,r;e[a]=(null==(s=n[a])?void 0:s.toString())||(null==(r=eV[a])?void 0:r.toString())||""}}),o(e),f("أسعار الصرف المعروضة هي للتحرير اليدوي. جلب الأسعار الديناميكي معطل.")}},[n,t]);let v=(e,t)=>{o(a=>({...a,[e]:t}))},N=async()=>{p(!0);try{var e,t,a,s,r,i;let d=await eG(),c={[R.Sj.USD]:null!=(e=d[R.Sj.USD])?e:n[R.Sj.USD],[R.Sj.SAR]:null!=(t=d[R.Sj.SAR])?t:n[R.Sj.SAR],[R.Sj.AED]:null!=(a=d[R.Sj.AED])?a:n[R.Sj.AED],[R.Sj.JOD]:null!=(s=d[R.Sj.JOD])?s:n[R.Sj.JOD],[R.Sj.SYP]:null!=(r=d[R.Sj.SYP])?r:n[R.Sj.SYP],[R.Sj.SDG]:null!=(i=d[R.Sj.SDG])?i:n[R.Sj.SDG]};c[R.Sj.EGP]=1;let m={...n,...c};(0,eo.ey)(m),l(m),o(e=>({...e,[R.Sj.USD]:m[R.Sj.USD].toString(),[R.Sj.SAR]:m[R.Sj.SAR].toString(),[R.Sj.AED]:m[R.Sj.AED].toString(),[R.Sj.JOD]:m[R.Sj.JOD].toString(),[R.Sj.SYP]:m[R.Sj.SYP].toString(),[R.Sj.SDG]:m[R.Sj.SDG].toString()})),f("تم جلب أسعار الصرف بنجاح."),y({title:"تم التحديث",description:"تم جلب أحدث أسعار الصرف."})}catch(e){console.error(e),y({variant:"destructive",title:"خطأ",description:"فشل جلب الأسعار. تأكد من الاتصال بالإنترنت."}),f("فشل جلب الأسعار. استخدم القيم الحالية.")}finally{p(!1)}};return(0,s.jsx)(el.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(el.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(el.c7,{children:[(0,s.jsx)(el.L3,{children:"إدارة أسعار الصرف (مقابل الجنيه المصري)"}),(0,s.jsx)(el.rr,{children:"يمكنك تعديل أو جلب أسعار الصرف مقابل الجنيه المصري. قيمة الجنيه المصري ثابتة على 1."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 my-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eF.J,{htmlFor:"fetch-date",children:"تاريخ أسعار الصرف"}),(0,s.jsx)(D,{date:j,setDate:g})]}),(0,s.jsxs)(c.$,{type:"button",onClick:N,disabled:x,variant:"outline",className:"w-full",children:[x?(0,s.jsx)(z.A,{className:"ms-2 h-4 w-4 animate-spin"}):(0,s.jsx)(eM.A,{className:"ms-2 h-4 w-4"}),"جلب أحدث أسعار الصرف"]}),h&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:h})]}),(0,s.jsx)("div",{className:"space-y-4 py-2 max-h-[calc(50vh-120px)] overflow-y-auto px-1",children:eL.filter(Boolean).map(e=>{var t;return(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,s.jsxs)(eF.J,{htmlFor:"rate-".concat(e.code),className:"col-span-1 text-sm",children:[e.name," (",e.symbol,")"]}),(0,s.jsx)(u.p,{id:"rate-".concat(e.code),type:"number",step:"any",value:e.code===R.Sj.EGP?"1":i[e.code]||"",onChange:t=>v(e.code,t.target.value),className:"col-span-2",placeholder:(null==(t=eV[e.code])?void 0:t.toString())||"0.00",disabled:e.code===R.Sj.EGP||d,readOnly:e.code===R.Sj.EGP})]},e.code)})}),(0,s.jsxs)(el.Es,{children:[(0,s.jsx)(el.HM,{asChild:!0,children:(0,s.jsx)(c.$,{type:"button",variant:"outline",disabled:d,children:"إلغاء"})}),(0,s.jsxs)(c.$,{type:"button",onClick:()=>{m(!0);let e={},t=!0;for(let a of eL){if(a.code===R.Sj.EGP)continue;let s=a.code,r=i[s],l=parseFloat(r);if(r&&""!==r.trim()&&!isNaN(l)&&l>0)e[s]=l;else{let r=eV[s]||n[s];if(r&&r>0)e[s]=r,y({variant:"default",title:"ملاحظة لسعر ".concat(a.name),description:"تم استخدام السعر السابق/الافتراضي (".concat(r,") لـ ").concat(a.name," بسبب قيمة غير صالحة أو فارغة.")});else{t=!1,y({variant:"destructive",title:"خطأ في سعر الصرف",description:"سعر الصرف لـ ".concat(a.name," غير صالح أو مفقود ولا يوجد احتياطي. يجب أن يكون رقمًا موجبًا.")}),m(!1);return}}}t&&(l({...n,...e,[R.Sj.EGP]:1}),y({title:"تم حفظ أسعار الصرف",description:"تم تحديث أسعار الصرف بنجاح."}),a(!1)),m(!1)},disabled:d,children:[d&&(0,s.jsx)(z.A,{className:"ms-2 h-4 w-4 animate-spin"}),"حفظ الأسعار"]})]})]})})}var eJ=a(6874),eB=a.n(eJ),e$=a(2643),eZ=a(5452),eH=a(2085),eY=a(5318);let eq=eZ.bL,eW=eZ.l9;eZ.bm;let eX=eZ.ZL,eK=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eZ.hJ,{className:(0,f.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});eK.displayName=eZ.hJ.displayName;let eQ=(0,eH.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 start-0 h-full w-3/4 border-e data-[state=closed]:slide-out-to-start data-[state=open]:slide-in-from-start sm:max-w-sm",right:"inset-y-0 end-0 h-full w-3/4 border-s data-[state=closed]:slide-out-to-end data-[state=open]:slide-in-from-end sm:max-w-sm"}},defaultVariants:{side:"right"}}),e0=r.forwardRef((e,t)=>{let{side:a="right",className:r,children:n,...l}=e;return(0,s.jsxs)(eX,{children:[(0,s.jsx)(eK,{}),(0,s.jsxs)(eZ.UC,{ref:t,className:(0,f.cn)(eQ({side:a}),r),...l,children:[n,(0,s.jsxs)(eZ.bm,{className:"absolute end-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[" ",(0,s.jsx)(eY.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"إغلاق"})," "]})]})]})});e0.displayName=eZ.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eZ.hE,{ref:t,className:(0,f.cn)("text-lg font-semibold text-foreground",a),...r})}).displayName=eZ.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eZ.VY,{ref:t,className:(0,f.cn)("text-sm text-muted-foreground",a),...r})}).displayName=eZ.VY.displayName;var e1=a(5532);function e5(e){var t;let{filters:a,onChange:n}=e,[l,o]=r.useState(!1),[d,m]=r.useState();return(0,s.jsxs)(eq,{open:l,onOpenChange:o,children:[(0,s.jsx)(eW,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",size:"sm",className:"gap-1",children:[(0,s.jsx)(Z.A,{className:"w-4 h-4"})," فلاتر"]})}),(0,s.jsxs)(e0,{side:"left",className:"w-80 sm:w-96",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"الفلاتر"}),(0,s.jsxs)("div",{className:"space-y-2 mb-6",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"الفترة"}),(0,s.jsxs)(b,{children:[(0,s.jsx)(w,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",className:"w-full justify-start gap-2",children:[(0,s.jsx)(h.A,{className:"w-4 h-4"}),(null==d?void 0:d.from)?(0,s.jsxs)("span",{children:[(0,i.GP)(d.from,"dd/MM/yyyy",{locale:e1.ar})," - ",d.to?(0,i.GP)(d.to,"dd/MM/yyyy",{locale:e1.ar}):"..."]}):(0,s.jsx)("span",{children:"اختر نطاقاً"})]})}),(0,s.jsx)(S,{className:"p-0",side:"bottom",align:"start",children:(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsx)(u.p,{type:"date",value:(null==d?void 0:d.from)?d.from.toISOString().substring(0,10):"",onChange:e=>{let t=new Date(e.target.value);m(e=>({from:t,to:null==e?void 0:e.to}))}}),(0,s.jsx)(u.p,{type:"date",className:"mt-2",value:(null==d?void 0:d.to)?d.to.toISOString().substring(0,10):"",onChange:e=>{let t=new Date(e.target.value);m(e=>({from:null==e?void 0:e.from,to:t}))}})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-2 mb-6",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"بحث"}),(0,s.jsx)(u.p,{placeholder:"كلمة مفتاحية...",value:null!=(t=a.search)?t:"",onChange:e=>n({...a,search:e.target.value})})]}),(0,s.jsx)(c.$,{className:"w-full",onClick:()=>{var e,t;n({...a,startDate:null==d||null==(e=d.from)?void 0:e.toISOString(),endDate:null==d||null==(t=d.to)?void 0:t.toISOString()}),o(!1)},children:"تطبيق"})]})]})}var e4=a(10);function e2(e){let{isGuest:t}=e,a=(0,l.useRouter)(),n=(0,l.useSearchParams)(),{toast:o}=(0,E.dj)(),d=r.useRef(null),[m,u]=r.useState(null),[x,p]=r.useState(!1),[h,j]=r.useState([]),[g,y]=r.useState(null),[v,N]=r.useState(()=>({...eo.zd})),[b,w]=r.useState(null),[S,D]=r.useState(!0),[C,R]=r.useState(!1),[A,T]=r.useState(null),[I,O]=r.useState(!1),[_,k]=r.useState(!1),[P,M]=r.useState(null),[G,L]=r.useState(!1),[V,U]=r.useState({}),J=r.useMemo(()=>h.filter(e=>{var t;return!(V.startDate&&new Date(e.date)<new Date(V.startDate)||V.endDate&&new Date(e.date)>new Date(V.endDate))&&(!V.search||!!(null==(t=e.description)?void 0:t.includes(V.search)))}),[h,V]);(0,eE.vC)("ctrl+s,meta+s",e=>{e.preventDefault(),H()},[g,h,v,_,x,m]),r.useEffect(()=>{let e=!0;return D(!0),(async()=>{var s,r,l,i,c,m,x;let{data:{session:h}}=await e$.N.auth.getSession(),f=null!=(s=null==h?void 0:h.user)?s:null,g=void 0!==t?t:"true"===sessionStorage.getItem("isGuest");if(f&&g&&(g=!1,sessionStorage.removeItem("isGuest")),e&&(u(f),p(g)),!f&&!g){e&&(o({title:"غير مصرح به",description:"يرجى تسجيل الدخول أو الاستمرار كضيف.",variant:"destructive"}),a.push("/"),D(!1));return}let v="true"===n.get("new"),b=n.get("edit");if(v)localStorage.removeItem("tripDraft"),e&&(y(null),j([]),N((0,eo.t$)()),w(null),null==(r=d.current)||r.resetForm(null),a.replace("/manage-trip",void 0));else if(b&&!g&&f){w(b);try{let{data:t,error:s}=await e$.N.from("trips").select("*").eq("id",b).eq("user_id",f.id).single();if(s&&e)o({variant:"destructive",title:"خطأ في تحميل الرحلة",description:"لم يتم العثور على الرحلة أو حدث خطأ. سيتم بدء رحلة جديدة."}),y(null),j([]),null==(l=d.current)||l.resetForm(null),a.replace("/manage-trip",void 0);else if(t&&e){let e=t.details;if(e&&e.tripStartDate&&e.tripEndDate){let t={...e,tripStartDate:new Date(e.tripStartDate),tripEndDate:new Date(e.tripEndDate)};y(t),null==(i=d.current)||i.resetForm(t)}let a=(Array.isArray(t.transactions)?t.transactions:[]).map(e=>({...e,date:new Date(e.date)})).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());j(a),N(t.exchange_rates||(0,eo.t$)()),o({title:"تم تحميل الرحلة للتعديل"})}}catch(t){e&&(o({variant:"destructive",title:"خطأ في تحميل الرحلة",description:"حدث خطأ غير متوقع. سيتم بدء رحلة جديدة."}),a.replace("/manage-trip",void 0))}}else{w(null);try{let t=localStorage.getItem("tripDraft");if(t){let a=JSON.parse(t);if(e){let e=a.tripDetails;if(e&&e.tripStartDate&&e.tripEndDate){let t={...e,tripStartDate:new Date(e.tripStartDate),tripEndDate:new Date(e.tripEndDate)};y(t),null==(c=d.current)||c.resetForm(t)}let t=(Array.isArray(a.transactions)?a.transactions:[]).map(e=>({...e,date:new Date(e.date)})).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());j(t),N(a.exchangeRates||(0,eo.t$)()),o({title:"تم استعادة مسودة رحلة",description:"تم تحميل آخر مسودة غير محفوظة."})}}else e&&(y(null),j([]),N((0,eo.t$)()),null==(m=d.current)||m.resetForm(null))}catch(t){e&&(y(null),j([]),N((0,eo.t$)()),null==(x=d.current)||x.resetForm(null))}}e&&D(!1)})(),()=>{e=!1}},[n,t,a,o]),r.useEffect(()=>{if(S||x||b)return;let e=setTimeout(()=>{(g||h.length>0)&&localStorage.setItem("tripDraft",JSON.stringify({tripDetails:g,transactions:h,exchangeRates:v}))},1e3);return()=>{clearTimeout(e)}},[g,h,v,b,x,S]);let B=()=>{console.log("[ManageTripPage Debug] handleCloseEditModal called."),T(null),R(!1)},$=e=>{console.log("[ManageTripPage Debug] handleTransactionUpdated called with:",e),j(t=>t.map(t=>t.id===e.id?e:t).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())),B()},Z=async()=>{var e;let t=await (null==(e=d.current)?void 0:e.validateAndGetData());return t?0!==h.length||b||x?void(M({tripDetails:t,transactions:h,exchangeRates:v}),setTimeout(()=>{window.print(),setTimeout(()=>{M(null)},1500)},300)):void o({variant:"destructive",title:"لا توجد معاملات",description:"يرجى إضافة معاملة واحدة على الأقل للطباعة."}):void o({variant:"destructive",title:"بيانات الرحلة غير صالحة",description:"يرجى مراجعة وتصحيح بيانات الرحلة في النموذج."})},H=async()=>{var e;if(x)return void o({variant:"destructive",title:"غير مسموح به",description:"لحفظ الرحلات على الخادم، يرجى تسجيل الدخول أو إنشاء حساب."});if(!m){o({variant:"destructive",title:"خطأ",description:"المستخدم غير مسجل. يرجى تسجيل الدخول أولاً."}),a.push("/");return}k(!0);let t=await (null==(e=d.current)?void 0:e.validateAndGetData());if(!t){o({variant:"destructive",title:"بيانات الرحلة غير مكتملة أو غير صالحة",description:"يرجى إكمال وتصحيح بيانات الرحلة في النموذج أعلاه."}),k(!1),console.error("[ManageTripPage Debug] Trip details validation failed in handleSaveFullTrip.");return}if(!b&&0===h.length){o({variant:"destructive",title:"لا توجد معاملات",description:"يرجى إضافة معاملة واحدة على الأقل قبل حفظ رحلة جديدة."}),k(!1);return}let s="".concat(t.driverName," - ").concat(t.cityName||t.countryName," - ").concat((0,i.GP)(t.tripStartDate,"dd/MM/yyyy")),r={...t,tripStartDate:t.tripStartDate.toISOString(),tripEndDate:t.tripEndDate.toISOString()},n=h.map(e=>({...e,date:new Date(e.date).toISOString()})),l={user_id:m.id,name:s,details:r,transactions:n,exchange_rates:v};console.log("[ManageTripPage Debug] Trip data to save:",JSON.stringify(l).substring(0,300)+"...");try{let e;if(b){console.log("[ManageTripPage Debug] Updating trip ID: ".concat(b," on server."));let{error:t}=await e$.N.from("trips").update({...l,updated_at:new Date().toISOString()}).eq("id",b).eq("user_id",m.id);e=t}else{console.log("[ManageTripPage Debug] Inserting new trip to server.");let{error:t}=await e$.N.from("trips").insert({...l,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();e=t}if(e)throw e;o({title:b?"تم تحديث الرحلة بنجاح!":"تم حفظ الرحلة بنجاح!",description:"تم ".concat(b?"تحديث":"حفظ",' رحلة "').concat(s,'".')}),y(null),j([]),N((0,eo.t$)()),d.current&&d.current.resetForm(null),w(null),a.replace("/saved-trips")}catch(e){o({variant:"destructive",title:"خطأ في حفظ/تحديث الرحلة",description:e.message||"حدث خطأ غير متوقع."})}finally{k(!1)}};if(S)return(0,s.jsxs)("div",{className:"flex h-screen w-full items-center justify-center",children:[(0,s.jsx)(z.A,{className:"h-16 w-16 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ps-3 text-lg",children:"جارٍ تحميل صفحة إدارة الرحلة..."})]});let Y=b?"تحديث الرحلة بالكامل والانتقال إلى السجل":"حفظ الرحلة بالكامل والانتقال إلى السجل",q=b?(0,s.jsx)(eI.A,{className:"ms-2 h-5 w-5"}):(0,s.jsx)(eO.A,{className:"ms-2 h-5 w-5"});return(0,s.jsxs)("div",{className:"container mx-auto p-4 md:p-8 space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-2 mb-6 no-print",children:[(0,s.jsx)(eB(),{href:"/dashboard",children:(0,s.jsxs)(c.$,{variant:"outline",children:[(0,s.jsx)(e_.A,{className:"ms-2 h-4 w-4"}),"العودة إلى لوحة التحكم"]})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 justify-center sm:justify-end",children:[(0,s.jsxs)(c.$,{onClick:()=>O(!0),variant:"outline",children:[(0,s.jsx)(ez.A,{className:"ms-2 h-4 w-4"}),"أسعار الصرف"]}),(0,s.jsxs)(c.$,{onClick:Z,variant:"outline",children:[(0,s.jsx)(ek.A,{className:"ms-2 h-4 w-4"}),"حفظ كـ PDF"]}),!x&&(0,s.jsxs)(c.$,{onClick:()=>a.push("/saved-trips"),variant:"outline",children:[(0,s.jsx)(eP.A,{className:"ms-2 h-4 w-4"}),"عرض الرحلات المحفوظة"]}),(0,s.jsxs)(c.$,{onClick:()=>L(!0),variant:"destructive",children:[(0,s.jsx)(W.A,{className:"ms-2 h-4 w-4"}),"حذف المسودة وبدأ تسجيل رحلة جديدة"]})]})]}),(0,s.jsx)(eT,{ref:d,onDetailsSubmit:e=>{console.log("[ManageTripPage Debug] handleTripDetailsUpdate called with:",e),y(e)},initialData:g}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start no-print",children:[(0,s.jsxs)("div",{className:"lg:col-span-1 space-y-8",children:[(0,s.jsx)(F,{onTransactionAdded:e=>{console.log("[ManageTripPage Debug] handleAddTransaction called with:",e),j(t=>[...t,e].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))},transactionToEdit:A,onTransactionUpdated:$,onCancelEdit:B,destinationType:null==g?void 0:g.destinationType}),(0,s.jsx)(e5,{filters:V,onChange:U}),(0,s.jsx)(ej,{transactions:J,exchangeRates:v,destinationType:null==g?void 0:g.destinationType})]}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)(ei,{transactions:J,onDeleteTransaction:e=>{console.log("[ManageTripPage Debug] handleDeleteTransaction called for ID: ".concat(e)),j(t=>t.filter(t=>t.id!==e)),o({title:"تم حذف المعاملة"})},onEditTransactionRequest:e=>{console.log("[ManageTripPage Debug] handleOpenEditModal called for transaction:",e),T(e),R(!0)}})})]}),!x&&(0,s.jsx)("div",{className:"mt-8 pt-6 border-t no-print",children:(0,s.jsxs)(c.$,{onClick:H,className:"w-full md:w-auto",size:"lg",disabled:_||x&&!m,children:[_&&(0,s.jsx)(z.A,{className:"ms-2 h-4 w-4 animate-spin"}),q,Y]})}),C&&A&&(0,s.jsx)(el.lG,{open:C,onOpenChange:e=>!e&&B(),children:(0,s.jsxs)(el.Cf,{className:"sm:max-w-[425px] md:max-w-[600px] no-print",children:[(0,s.jsxs)(el.c7,{children:[(0,s.jsx)(el.L3,{children:"تعديل المعاملة"}),(0,s.jsx)(el.rr,{children:" قم بتحديث تفاصيل معاملتك هنا. انقر على حفظ عند الانتهاء. "})]}),(0,s.jsx)(F,{transactionToEdit:A,onTransactionUpdated:$,onCancelEdit:B,className:"pt-4",destinationType:null==g?void 0:g.destinationType})]})}),(0,s.jsx)(eU,{isOpen:I,onOpenChange:O,currentRates:v,onRatesUpdate:e=>{N(e),(0,eo.ey)(e),o({title:"تم تحديث أسعار الصرف محليًا لهذه الرحلة"})}}),(0,s.jsx)("div",{className:(0,f.cn)("print-only",!P&&"hidden"),children:P&&(0,s.jsx)(ev,{transactions:P.transactions,exchangeRates:P.exchangeRates,tripDetails:P.tripDetails})}),(0,s.jsx)(e4.Lt,{open:G,onOpenChange:L,children:(0,s.jsxs)(e4.EO,{children:[(0,s.jsxs)(e4.wd,{children:[(0,s.jsx)(e4.r7,{children:"هل أنت متأكد تمامًا؟"}),(0,s.jsx)(e4.$v,{children:"سيؤدي هذا الإجراء إلى حذف مسودة الرحلة الحالية بشكل دائم. لا يمكن التراجع عن هذا الإجراء."})]}),(0,s.jsxs)(e4.ck,{children:[(0,s.jsx)(e4.Zr,{children:"إلغاء"}),(0,s.jsx)(e4.Rx,{onClick:()=>{j([]),y(null),w(null),d.current&&d.current.resetForm(),localStorage.removeItem("tripDetailsDraft"),localStorage.removeItem("transactionsDraft"),a.push("/manage-trip",{scroll:!1}),o({title:"تم حذف المسودة",description:"يمكنك الآن البدء في تسجيل رحلة جديدة."})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"نعم، احذف المسودة"})]})]})})]})}let e3=(0,n.default)(()=>Promise.resolve(e2),{ssr:!1,loading:()=>(0,s.jsxs)("div",{className:"flex h-screen w-full items-center justify-center",children:[(0,s.jsx)(z.A,{className:"h-16 w-16 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ps-3 text-lg",children:"جارٍ تحميل صفحة إدارة الرحلة..."})]})});function e6(){let e="true"===sessionStorage.getItem("isGuest");return(0,s.jsx)(e3,{isGuest:e})}},7759:(e,t,a)=>{"use strict";a.d(t,{C5:()=>j,MJ:()=>f,eI:()=>p,lR:()=>h,lV:()=>d,zB:()=>m});var s=a(5155),r=a(2115),n=a(9708),l=a(2177),i=a(9434),o=a(5057);let d=l.Op,c=r.createContext({}),m=e=>{let{...t}=e;return(0,s.jsx)(c.Provider,{value:{name:t.name},children:(0,s.jsx)(l.xI,{...t})})},u=()=>{let e=r.useContext(c),t=r.useContext(x),{getFieldState:a,formState:s}=(0,l.xW)(),n=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},x=r.createContext({}),p=r.forwardRef((e,t)=>{let{className:a,...n}=e,l=r.useId();return(0,s.jsx)(x.Provider,{value:{id:l},children:(0,s.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",a),...n})})});p.displayName="FormItem";let h=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:n,formItemId:l}=u();return(0,s.jsx)(o.J,{ref:t,className:(0,i.cn)(n&&"text-destructive",a),htmlFor:l,...r})});h.displayName="FormLabel";let f=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:l,formDescriptionId:i,formMessageId:o}=u();return(0,s.jsx)(n.DX,{ref:t,id:l,"aria-describedby":r?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!r,...a})});f.displayName="FormControl",r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:n}=u();return(0,s.jsx)("p",{ref:t,id:n,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})}).displayName="FormDescription";let j=r.forwardRef((e,t)=>{var a;let{className:r,children:n,...l}=e,{error:o,formMessageId:d}=u(),c=o?String(null!=(a=null==o?void 0:o.message)?a:""):n;return c?(0,s.jsx)("p",{ref:t,id:d,className:(0,i.cn)("text-sm font-medium text-destructive",r),...l,children:c}):null});j.displayName="FormMessage"},9409:(e,t,a)=>{"use strict";a.d(t,{bq:()=>u,eb:()=>f,gC:()=>h,l6:()=>c,yv:()=>m});var s=a(5155),r=a(2115),n=a(4582),l=a(9556),i=a(7381),o=a(518),d=a(9434);let c=n.bL;n.YJ;let m=n.WT,u=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(n.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[r,(0,s.jsx)(n.In,{asChild:!0,children:(0,s.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=n.l9.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})});x.displayName=n.PP.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})});p.displayName=n.wn.displayName;let h=r.forwardRef((e,t)=>{let{className:a,children:r,position:l="popper",...i}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsxs)(n.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...i,children:[(0,s.jsx)(x,{}),(0,s.jsx)(n.LM,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(p,{})]})})});h.displayName=n.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.JU,{ref:t,className:(0,d.cn)("py-1.5 ps-8 pe-2 text-sm font-semibold",a),...r})}).displayName=n.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(n.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 ps-2 pe-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsxs)("span",{className:"absolute end-2 flex h-3.5 w-3.5 items-center justify-center",children:[" ",(0,s.jsx)(n.VF,{children:(0,s.jsx)(o.A,{className:"h-4 w-4"})})]}),(0,s.jsx)(n.p4,{children:r})]})});f.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=n.wv.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[856,648,239,317,370,429,762,656,441,684,358],()=>t(2697)),_N_E=e.O()}]);